name: Run terraform validate

on:
  push:
    branches-ignore: main
  pull_request:
    branches-ignore: main

jobs:
  ansible_v2:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v2
      with:
        ref: ${{ github.ref }}

    - name: Run ansible-lint v2 test
      run: sudo apt install ansible-lint && ansible-lint ansible/playbooks/*

  terraform:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v2
      with:
        ref: ${{ github.ref }}

    - name: terraform validate
      run: cd terraform/prod && terraform init && terraform validate
